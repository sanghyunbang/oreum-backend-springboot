<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.oreum.posts.dao.PostsDAO">

  <!-- posts 테이블에 저장 -->
  <insert id="insertpost" parameterType="com.oreum.posts.dto.PostsDTO"
   useGeneratedKeys="true" keyProperty="postId">
    INSERT INTO posts (
      user_id, board_id, title, content
    ) VALUES (
      #{userId}, #{boardId}, #{title}, #{content}
    );
  </insert>

  <!-- curation_details 테이블에 저장 -->
  <insert id="insertCurationDetail" parameterType="com.oreum.posts.dto.PostsDTO">
    INSERT INTO curation_details (
      post_id, mountain_name, route, caution, nearby_attraction
    ) VALUES (
      #{postId}, #{mountainName}, #{route}, #{caution}, #{nearbyAttraction}
    );
  </insert>
  
  <insert id="insertMeetingDetail" parameterType="com.oreum.posts.dto.PostsDTO">
    INSERT INTO meeting_details (
      post_id, meeting_date, meeting_location
    ) VALUES (
      #{postId}, #{meetingDate}, #{meetingLocation}
    );
  </insert>

  <!-- post_media 테이블에 URL 저장 -->
  <insert id="insertPostMedia">
    INSERT INTO post_media (post_id, media_type, media_url)
    VALUES (
      #{postId}, #{mediaType}, #{mediaUrl}
    )
  </insert>
<!-- 전체 게시글 가져오기 -->
<select id="getAllPosts" resultType="com.oreum.posts.dto.PostsDTO">
  SELECT * FROM posts ORDER BY created_at DESC
</select>

<!-- 댓글 수 세기 -->
<select id="countComments" resultType="int" parameterType="int">
  SELECT COUNT(*) FROM comments WHERE post_id = #{postId}
</select>


  </mapper>